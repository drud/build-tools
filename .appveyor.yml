# At this time the appveyor.yml doesn't help us much because we use
# Linux docker containers extensively, and appveyor is unable to use them.
# So even building (not to mention testing) isn't possible.
version: "{build}"
image: Windows Server 2019


install:
  - cinst git
  - refreshenv
  - set PATH="C:\Program Files\git;C:\Program Files\git\bin;%PATH%"
  - where bash
  - cinst ddev make golang mysql-cli mkcert
  - git config --global core.autocrlf false
  - refreshenv



build_script:
  - ps: Switch-DockerLinux
  - refreshenv
  - set PATH="C:\Program Files\git;C:\Program Files\git\bin;%PATH%"
  - cmd: where bash
  - docker version && docker-compose version
#  - docker volume create --driver local --opt type=nfs test101
#  - docker network create test102
  - bash -c "which ddev || echo 'ddev oddly not found in path'"
#  - cmd: ddev.exe
#  - ps: mkdir D:\junk | Out-Null
#  - ps: cd D:\junk
#  - ddev config global --instrumentation-opt-in=false
#  - ddev config --project-type php
#  - ddev start
  - icacls %TEMP% /grant everyone:f
  - mklink /J D:\user-tmp %TEMP%
  - echo %cd%
  - cmd: mklink /J D:\dwork %cd%
  - cd D:\dwork
  - git clone git://github.com/drud/ddev.git
  - cd ddev
  - cmd: where bash
  - cmd: bash -c 'printf "#!/bin/bash\nexit\n" >.buildkite/nfstest.sh'
  - cmd: .buildkite/test.cmd
  - cmd: bash -c 'printf $PATH'
#  - bash -c 'export PATH="$PATH:/c/program files/ddev"; mkdir junk && cd junk && ddev config --project-type php && ddev start'


test: off
deploy: false
